!function(a){function b(){return"xxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)})}function c(a){a.preventDefault()}function d(b,c){var d=a(b.settings.drop_element),e=a("#gfcs-sample");d.removeClass("gf-dragging"),c?(e.show(),d.show()):(e.hide(),d.hide())}function e(a){var b=plupload.formatSize(a.size).toUpperCase(),c=o(a),d=a.dateUploaded?a.dateUploaded:Math.round(Date.now()/1e3),e=a.isFromFilter?"":'<span class="gfcs-remove"><i class="gficon-subtract"></i></span>',g=a.isFromFilter?f(a):"";return'\t\t\t<div id="{0}" class="{3}"> \t\t\t\t<span class="gfcs-file-icon"></span> {1} <span class="gfcs-file-size">{2}</span> <span class="gfcs-file-date"> | {4}</span> <b class="gfcs-file-percent"></b> \t\t\t\t<span class="gfcs-success"><i class="gficon-tick gf_valid"></i></span> \t\t\t\t{5} \t\t\t\t<span class="gfcs-processing"></span> \t\t\t</div> \t\t\t{6}'.format(a.id,a.name,b,c,r(d),e,g)}function f(){return'<div class="gfcs-source-message gforms_help_alert"><i class="fa fa-warning"></i> {0}</div>'.format(gformChainedSelectData.strings.importedFilterFile)}function g(){return'<div class="gfcs-source-message gforms_red_alert"><i class="fa fa-warning"></i> {0}</div>'.format(gformChainedSelectData.strings.errorImportingFilterFile)}function h(b,c){var d=a(b.settings.progress);c?d.html(e(c)):d.html("")}function i(b){for(var c=a("#field_"+b.id+" .ginput_container"),d="",e=0;e<b.inputs.length;e++){d+='<span><select disabled="disabled">'+("<option>"+b.inputs[e].label+"</option>")+"</select></span>\n"}c.html(d)}function j(a){var b=GetSelectedField();return b&&(void 0===a.field||a.field.id==b.id)}function k(a){a.stop(),a.refresh(),a.start()}function l(a){a.files.splice(0,a.files.length),a.refresh(),a.start();var b=GetFieldById(a.field.id);b.choices=gformChainedSelectData.defaultChoices,b.inputs=n(b),b.gfcsFile=null,i(b),h(a,!1),d(a,!0)}function m(){return gformChainedSelectData.defaultChoices}function n(b){for(var c=a.extend(!0,[],gformChainedSelectData.defaultInputs),d=0;d<c.length;d++)c[d].id=b.id+"."+(d+1);return c}function o(a){return"gfcs-status-{0}".format(p(a))}function p(a){return a.status&&a.status==plupload.UPLOADING?100==a.percent?"processing":"uploading":"complete"}function q(b,c){delete window.gfcsErrorTimeout,a("#gfcs-error").remove();var d=a('<div id="gfcs-error" class="error" style="width:375px;padding:1px 12px;"><p>{0}</p></div>'.format(c));a(b.settings.progress).html(d),window.gfcsErrorTimeout=setTimeout(function(){d.slideUp(function(){d.remove()})},5e3)}function r(a){var b=Date.now()/1e3-a,c={hours:{period:3600,label:{singular:"hour",plural:"hours"}},minutes:{period:60,label:{singular:"min",plural:"mins"}},seconds:{period:1,label:{singular:"sec",plural:"secs"}}};for(var d in c)if(c.hasOwnProperty(d)){var e=c[d],f=Math.round(b/e.period),g="";if("hours"==d&&f>=24)break;if("seconds"==d&&0==f)g="{0} {1} ago".format(1,e.label.singular);else if(f>0){var h=f>1?e.label.plural:e.label.singular;g="{0} {1} ago".format(f,h);break}}if(!g){var i=new Date(1e3*a),j=i.toDateString().split(" ");g="{0} {1}, {2}".format(j[1],j[2],j[3])}return g}window.GFCSAdmin={getDefaultInputs:function(b){for(var c=a.extend(!0,[],gformChainedSelectData.defaultInputs),d=0;d<c.length;d++)c[d].id=b.id+"."+(d+1);return c},updateAlignment:function(b){var c=GetSelectedField();c.chainedSelectsAlignment=b,a("#field_"+c.id).find(".ginput_container").removeClass("horizontal vertical").addClass(b)}};var s={gform_unique_id:b(),field_id:null,form_id:null};s["_gform_file_upload_nonce_{0}".format(form.id)]=window.gform_chainedselects_file_upload_nonce,new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:document.getElementById("pickfiles"),container:document.getElementById("gfcs-container"),progress:document.getElementById("gfcs-progress"),drop_element:document.getElementById("gfcs-drop"),dragdrop:!0,url:gformChainedSelectData.fileUploadUrl,filters:{max_file_size:parseInt(gformChainedSelectData.maxFileSize)/1e6+"mb",mime_types:[{title:"",extensions:"csv"}]},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap",multipart_params:s,init:{PostInit:function(b){a(document).bind("gform_load_field_settings",function(c,e,f){if(j(b)||k(b),"chainedselect"==e.type){if(e.gfcsFilterEnabled&&!e.gfcsFile){return a(b.settings.progress).html(g()),void d(b,!1)}b.field=a.extend({},e);var i=b.getOption("multipart_params");i.field_id=e.id,i.form_id=f.id,b.setOption("multipart_params",i),document.getElementById("gfcs-progress").innerHTML="",e.gfcsFile?(h(b,e.gfcsFile),d(b,!1)):l(b)}}),a(b.settings.drop_element).on("dragover",function(){a(this).addClass("gf-dragging")}).on("dragleave",function(){a(this).removeClass("gf-dragging")}),a(b.settings.drop_element).on({dragenter:c,dragover:c}),a(b.settings.progress).on("click","span.gfcs-remove",function(){b.field.gfcsFilterEnabled||l(b)}),gform.addFilter("gform_duplicate_field_chainedselect",function(a){return a.gfcsFilterEnabled&&(a.gfcsFile=null,a.gfcsFilterEnabled=!1,a.choices=m(),a.inputs=n(a)),a})},FilesAdded:function(b,c){d(b,!1);var e=1,f=b.files.length,g=f>e;if(c=b.files,g){var i=c.length-1;a.each(c,function(a,c){a<i&&b.removeFile(c)})}a.each(c,function(c,d){if(d.status==plupload.FAILED)return void b.removeFile(d);h(b,d),a("#"+d.id).attr("class",o(d))}),b.refresh(),b.start()},UploadProgress:function(b,c){if(!j(b))return void k(b);document.getElementById(c.id).getElementsByTagName("b")[0].innerHTML="<span>"+c.percent+"%</span>",a("#"+c.id).attr("class",o(c))},Error:function(a,b){l(a);var c=gformChainedSelectData.strings.errorUploadingFile+"<br>"+b.message;-601==b.code?c=gformChainedSelectData.strings.errorFileType:-600==b.code&&(c=gformChainedSelectData.strings.errorFileSize),q(a,c)},FileUploaded:function(b,c,d){var e;try{e=a.secureEvalJSON(d.response)}catch(a){e={status:"error",error:{message:!1}}}if("error"==e.status)return l(b),void q(b,gformChainedSelectData.strings.errorProcessingFile+"<br>"+e.error.message);if(100==c.percent&&e.status&&"ok"==e.status){var f=GetSelectedField();f.choices=e.data.choices,f.inputs=e.data.inputs,f.gfcsFile={name:c.name,type:c.type,size:c.size,dateUploaded:Math.round((new Date).getTime()/1e3),isFromFilter:!1},i(f),a("#"+c.id).attr("class",o(c))}}}}).init()}(jQuery);